#      _____                              __    __
#     /\___ \                            /\ \  /\ \__
#     \/__/\ \  __  __    ___     ___    \ `\`\\/'/\_\
#        _\ \ \/\ \/\ \ /' _ `\  / __`\   `\ `\ /'\/\ \
#       /\ \_\ \ \ \_\ \/\ \/\ \/\ \L\ \    `\ \ \ \ \ \
#       \ \____/\ \____/\ \_\ \_\ \____/      \ \_\ \ \_\
#        \/___/  \/___/  \/_/\/_/\/___/        \/_/  \/_/
#
#
# ==================== JunoYi 框架配置 ====================
junoyi:
  # 框架版本号
  version: 0.1.0-alpha
  # 框架名称（可选）
  name: JunoYi
  # 版权年份（可选）
  copyrightYear: 2025
  copyright: JunoYi钧逸
  # 网站备案号
  registration: 苏@123456
  # LOGO 图片文件（在resources/public/目录中存放，这里指定文件名）
  logo: LOGO.png

  # ==================== 日志配置 ====================
  log:
    # 控制台输出配置
    console:
      # 是否启用控制台日志输出
      enabled: true
      # 是否启用彩色日志输出（true=彩色，false=黑白）
      color-enabled: true
      # 是否显示线程名称
      show-thread-name: true
      # 是否显示MDC（Mapped Diagnostic Context）上下文信息
      show-mdc: true
      # 是否显示类名
      show-class-name: true
      # 类名显示的最大长度（超出部分会被截断）
      max-class-name-length: 25
    
    # 日志级别配置
    level:
      # 根日志级别
      root: INFO
      # JunoYi 框架日志级别（设置为 DEBUG 以查看所有日志）
      junoyi: INFO
      # Spring 框架日志级别
      spring: WARN
      # MyBatis 日志级别
      mybatis: WARN
      # SQL 日志级别
      sql: DEBUG

    # 文件输出配置
    file:
      # 是否启用文件日志输出
      enabled: true
      # 日志文件存储目录（只提供目录，不包含文件名）
      path: ./temp/logs
      # 单个日志文件的最大大小（支持KB、MB、GB单位）
      max-size: 100MB
      # 保留的历史日志文件数量（超过数量的旧文件会被删除）
      max-history: 30
      # 所有日志文件的总大小上限（超过后会删除最旧的文件）
      total-size-cap: 1GB
      # 是否压缩历史日志文件（true=压缩为.gz格式，false=不压缩）
      compress: true
      # 日志文件编码格式
      encoding: UTF-8

    # 日志格式配置
    format:
      # 日期时间显示格式（遵循Java SimpleDateFormat格式）
      date-time-pattern: "yyyy-MM-dd HH:mm:ss.SSS"
      # 异常堆栈跟踪显示的最大行数（0=显示全部，>0=限制行数）
      max-stack-trace-lines: 0
      # MDC属性显示的最大数量（超出部分会被截断）
      max-mdc-properties: 3
      # 线程名称显示的最大长度（超出部分会被截断）
      max-thread-name-length: 30
      # 是否简化包名显示（true=简化，false=显示完整包名）
      simplify-package-names: true
      # 包名简化映射配置（将长包名简化为短字符）
      package-simplifications:
        "com.junoyi.framework": "c.j.f"           # JunoYi框架包简化为"j"
        "org.springframework": "s" # Spring框架包简化为"s"
        "com.baomidou": "m"        # MyBatis Plus包简化为"m"
        "org.apache": "a"          # Apache包简化为"a"
        "java.lang": "j.l"         # Java基础包简化为"j.l"
        "java.util": "j.u"         # Java工具包简化为"j.u"

    # 异步日志配置
    async:
      # 是否启用异步日志（true=异步，false=同步）
      enabled: true
      # 异步日志队列大小（超过队列容量的日志会根据策略处理）
      queue-size: 256
      # 队列满时的丢弃策略（DISCARD=丢弃新日志，BLOCK=阻塞等待）
      discarding-threshold: DISCARD
      # 是否包含调用者信息（类名、方法名、行号，true=包含但影响性能，false=不包含）
      include-caller-data: false
      # 异步日志线程池大小（建议设置为CPU核心数的1-2倍）
      thread-pool-size: 1

  # ==================== 数据源配置 ====================
  datasource:
    # 启用 SQL 美化输出
    sql-beautify-enabled: true
    # 启用慢 SQL 监控
    slow-sql-enabled: true
    # 慢 SQL 阈值（毫秒）
    slow-sql-threshold: 3000
    # 启用 SQL 日志
    sql-log-enabled: true

  # ==================== 事件配置 ====================
  event:

  # ==================== Web 配置 ====================
  web:
    # 跨域
    cors:
      # 是否开启跨域
      enable: true
      # 是否允许携带凭证（如 Cookie、Authorization Header）
      allow-credentials: true
      # 允许跨域访问的源（Origin）
      allowed-origins:
        - https://admin.junoyi.com
        - http://localhost:3006
      # 允许跨域的方法
      allowed-methods:
        - GET
        - POST
        - PUT
        - DELETE
      # 允许跨域的请求头
      allowed-headers:
        - Authorization
        - Content-Type

    # XSS 攻击防护
    xss:
      # 是否启用 XSS 过滤
      enable: true
      # 过滤模式: clean（清理危险内容) / escape(转义特殊字符) / reject(拒绝请求)
      # 生产环境建议使用 reject模式，clean模式会清除xss攻击内容，但是请求任何会传给controller继续执行，
      # reject 模式
      mode: reject  # clean / escape / reject
      # 是否过滤参数
      filter-parameter: true
      # 是否过滤请求头
      filter-header: true
      # 是否过滤请求体
      filter-body: true
      # 排除的 URL 路径（支持 Ant 风格）
      exclude-urls:
        - /test
      # 排除的请求方法（如 GET)
      exclude-methods:
        - GET

    # SQL 注入严格防护
    sql-injection:
      # 是否启用
      enable: true
      # 防护模式：detect(检测并拒绝) / clean(清理)
      mode: detect
      # 是否过滤参数
      filter-parameter: true
      # 是否过滤请求头
      filter-header: false
      # 是否过滤请求体
      filter-body: true
      # 排除的 URL 路径（支持 Ant 风格）
      exclude-urls:
        - /api/report/**
      # 自定义危险关键词（追加到默认列表）
      custom-keywords:
        - xp_cmdshell
    # 访问日志
    access-log:
      enable: true                    # 是否启用
      slow-request-threshold: 3000    # 慢请求阈值（毫秒）
      log-request-params: true        # 是否记录请求参数
      log-request-headers: false      # 是否记录请求头
      exclude-paths: # 排除路径
        - /actuator/**
        - /favicon.ico

  # ==================== 验证码配置 ====================
  captcha:
    # 是否启用验证码
    enable: true
    # 默认验证码类型: IMAGE(图片)
    type: IMAGE
    # 验证码过期时间（秒）
    expire-seconds: 120
    # 图片验证码配置
    image:
      # 验证码长度
      length: 4
      # 图片宽度
      width: 150
      # 图片高度
      height: 50
      # 干扰线数量
      line-count: 4
      # 干扰圆圈数量
      circle-count: 15
      # 扭曲程度 (0-1, 0=不扭曲, 1=最大扭曲, 推荐0.2-0.4)
      distortion: 0.3
      # 噪点数量
      noise-count: 50
      # 字体大小
      font-size: 32
      # 验证码类型: math(数学运算) / char(字符)
      code-type: math

  # ==================== 安全验证配置 ====================
  security:
    # api 接口加密 (建议: 开发环境将接口加密关闭方便调试，生产环境开启保证安全)
    # 建议：
    # 生产环境不要使用示例中的密钥对，请自行生成密钥对替换resource/keys/目录中的密钥文件
    # 推荐生成2048位密钥，4096位也可以，不建议提高安全性了但是会降低性能
    api-encrypt:
      enable: false
      # 是否加密请求体
      request: true
      # 是否加密响应体
      response: true
    # 白名单路径
    whitelist:
      - /auth/login
      - /auth/register
      - /system/info
      - /captcha/**
    # 登录机制
    login:
      # 最大登录失败次数
      max-fail-count: 5
      # 登录失败冷却时间（分钟）
      fail-coll-down-minutes: 5
      # 是否启用 ip 限制模式
      enable-ip-limit: true
      # ip限制最大失败次数
      ip-max-fail-count: 20
      # ip限制冷却时间
      ip_fail_coll_down-minutes: 30
    # token 机制
    token:
      header: Authorization
      # 令牌密钥 (HS512 算法要求至少 64 字符)
      secret: fd5K48pq6pyZaBoYk56mGiEWVM4qcX0k9PHRjunoyi2025SecureTokenKeyForHS512Algorithm
      # 是否开启单点登录（同一平台只允许一个会话）
      # true: 单点登录，同平台重复登录会被拒绝
      # false: 多点登录，允许同平台多个会话（默认）
      single-login: false
      # Access Token 有效期（不同平台不同有效期）
      access-expire:
        admin-web: 30m      # 后台管理 Web（安全要求高，有效期短）
        front-web: 2h       # 前台用户 Web（用户体验优先，有效期稍长）
        miniprogram: 12h    # 小程序
        app: 24h            # App
        desktop: 7d         # 桌面应用
      # Refresh Token 有效期
      refresh-expire:
        admin-web: 7d       # 后台管理 Web
        front-web: 14d      # 前台用户 Web
        miniprogram: 30d    # 小程序
        app: 30d            # App
        desktop: 90d        # 桌面应用

  # ==================== Permission 配置 ====================
  permission:
    # 是否启用权限控制功能
    enable: true
    # 是否启用字段权限功能
    field-permission-enable: true


# Spring Boot服务器配置
server:
  # 应用服务端口
  port: 7588

# Spring Boot 日志配置
logging:
  level:
    # 屏蔽 BeanPostProcessor 相关警告
    org.springframework.context.support.PostProcessorRegistrationDelegate: ERROR
    # 屏蔽 Tomcat 内嵌 Servlet 容器初始化日志
    org.apache.catalina.core: WARN
    # 屏蔽 MyBaits 扫描Mapper时候出现不必要的日志
    org.mybatis.spring.mapper.ClassPathMapperScanner: ERROR
    # 屏蔽 Netty DNS 警告
    io.netty.resolver.dns: ERROR
#    com.junoyi: DEBUG


# ==================== Spring Boot 配置 ====================
spring:
  profiles:
    active: local
  
  # DevTools 配置
  devtools:
    livereload:
      # 禁用 LiveReload 服务器（避免端口占用警告）
      enabled: false

